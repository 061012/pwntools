#!/usr/bin/env python
from pwn import crypto

# n = pq (pretty bad key)
n = 52663327194823108047941861363554667296911056447871887851271987923908183897674377410438840426978134174085827671405371681087438977062350370399673668797470776186113807376857893834326388369431932515506157599029337496768833168170979530546490477646457979867770363293437566350789835757689162734143512153253903202593

# Exponent
e = 10662335266334707061416010175090707752184800780484871995102723956866061990195856830708788718069689026583063666085399768189451747239018890190254375851709269

# Encrypted message
m1 = "This message is encrypted, lolz!"
c = crypto.encrypt(crypto.bytes2int(m1),e,n)

# Key is faulty, so we can calculate p and q
(p,q) = crypto.fermat_factor(n)

# Find private key
d = crypto.calculate_private_key(p,q,e)

# Decrypt message
m2 = crypto.int2bytes(crypto.decrypt(c,d,n))
print "Decrypted message:", m2
